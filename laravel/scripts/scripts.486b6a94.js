"use strict";angular.module("myBlogApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","apiService"]).config(["$routeProvider",function(a){a.when("/blog",{templateUrl:"views/blog.html",controller:"blogCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"}).otherwise({redirectTo:"/blog"})}]);var apiService=angular.module("apiService",["ngResource"]);apiService.factory("userSessionTokenService",["$resource",function(a){var b="/public/oauth/token";return a(b,{},{create:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}]),apiService.factory("Accountdetails",["$resource",function(a){var b="/oauth/token";return a(b,{},{create:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}]),apiService.factory("Accountdetails",["$resource",function(a){var b="/oauth/token";return a(b,{},{create:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}]),apiService.factory("getAllBlog",["$resource",function(a){var b="/public/api/post";return a(b,{query:{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}]),apiService.factory("getBlogUpdate",["$resource",function(a){var b="/public/api/post";return a(b,{},{create:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"}},"delete":{method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}]),apiService.factory("getBlogDelete",["$resource",function(a){var b="/public/api/post/:id";return a(b,{id:"@id"},{cancel:{method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}]),angular.module("myBlogApp").service("authenticationService",["$rootScope","$window","$q","$log","userSessionTokenService","Accountdetails",function(a,b,c,d,e,f){function g(a){h(a),i()}function h(b){p={},p.accessToken=b.access_token,p.refreshToken=b.refresh_token,p.tokenExpiresInSecs=b.expires_in,a.$broadcast(t,v)}function i(){f.get(function(b){angular.isDefined(b.errors)&&b.errors.length>=1&&"Institution is currently inactive"==b.errors[0].user_message||(m(b.data),a.$broadcast(t,x))},function(a){return a})}function j(){p=null,q=null}function k(a){return angular.isDefined(a.access_token)&&angular.isDefined(a.refresh_token)&&angular.isDefined(a.expires_in)}function l(a){h(a),s&&(s=!1,i())}function h(b){p={},p.accessToken=b.access_token,p.refreshToken=b.refresh_token,p.tokenExpiresInSecs=b.expires_in,sessionManagementService.storeSessionToken(p),a.$broadcast(t,v)}function i(){f.get(function(b){angular.isDefined(b.errors)&&b.errors.length>=1&&"Institution is currently inactive"==b.errors[0].user_message||(sessionManagementService.storeAccountStatus(!0),m(b.data),a.$broadcast(t,x))},function(a){return a})}function m(a){q=a}var n="testclient",o="testpass",p=null,q=null,r=null,s=!1,t="authenticationService",u=".tokenRefreshFailed",v=".tokenRefreshed",w=".authFailed",x=".authSuccess",y=".authSignOut",z=".authSessionExpired";this.is_authenticated=function(){return null===p||p=={}?!1:!0},this.authenticate=function(b,d){var f=c.defer(),h=$.param({grant_type:"password",username:b,password:d,client_id:n,client_secret:o});return e.create({},h,function(b){angular.isDefined(b.errors)&&b.errors.length>0?(f.reject(),a.$broadcast(t,w)):(f.resolve(),g(b))},function(){a.$broadcast(t,w)}),f.promise},this.validateSessionToken=function(a){p={},p.accessToken=null,p.refreshToken=a,p.tokenExpiresInSecs=null,s=!0,this.refreshToken()},this.signOut=function(b){j(),sessionManagementService.invalidate(),b?a.$broadcast(t,z):a.$broadcast(t,y)},this.refreshToken=function(){if(s||this.hasToken()){if(null!==r)return r.promise;r=c.defer();var b=$.param({client_id:n,client_secret:o,grant_type:"refresh_token",refresh_token:sessionManagementService.getRefreshToken()});return e.create({},b,function(b){angular.isDefined(b.errors)&&b.errors.length>0||!k(b)?(d.error("Error occurred while refreshing token."),a.$broadcast(t,u),r.reject(u)):(l(b),r.resolve(b)),r=null},function(){a.$broadcast(t,u),r.reject(u),r=null}),r.promise}},this.hasToken=function(){return null===p&&(p=sessionManagementService.getSessionToken()),null!==p&&null!==p.accessToken},this.getAccessToken=function(){return this.hasToken()?p.accessToken:null}}]),angular.module("myBlogApp").controller("commanCtrl",["$scope","authenticationService",function(a,b){a.is_authenticated=b.is_authenticated,a.logout=function(){location.reload()}}]),angular.module("myBlogApp").controller("blogCtrl",["$scope","$location","authenticationService","getAllBlog","getBlogUpdate","getBlogDelete",function(a,b,c,d,e,f){function g(){d.query({},function(b){a.editBlog=0,a.editBlogData={},a.Blogs=b},function(){})}a.Blogs=[],a.editBlog=0,a.editBlogData={},c.is_authenticated()?(a.addNew=function(){a.editBlog=1,a.editBlogData={}},a.blogEdit=function(b){a.editBlog=2,a.editBlogData=angular.copy(b)},a.cancelEdit=function(b){a.editBlog=0,a.editBlogData={}},a.Delete=function(b){f.cancel({id:b.id},function(){a.editBlog=0,a.editBlogData={},g()})},a.SaveEdit=function(){var b="";1===a.editBlog?b=e.create:2===a.editBlog&&(b=e.update),b({},a.editBlogData,function(){a.editBlog=0,a.editBlogData={},g()})},g()):b.path("/login")}]),angular.module("myBlogApp").controller("loginCtrl",["$scope","$location","authenticationService",function(a,b,c){a.Username="",a.passwd="",a.login=function(){c.authenticate(a.Username,a.passwd).then(function(){b.path("/blog")},function(){})}}]);